# Codebase Structure

**Analysis Date:** 2026-03-01

## Directory Layout

```
VibeKit-cli/
├── bin/                      # CLI entry point
│   └── launchblocks.ts      # Command router using commander.js
├── src/                      # Source code
│   ├── commands/            # Command handlers (init, add)
│   ├── interview/           # Interactive Q&A modules
│   │   ├── questions/       # Individual question modules
│   │   ├── runner.ts        # Interview orchestrator
│   │   └── types.ts         # Interview data types
│   ├── generator/           # Template generation pipeline
│   ├── setup/               # MCP server detection & setup
│   ├── templates/           # Handlebars templates (shipped with built code)
│   │   ├── specs/           # Module specification templates
│   │   ├── schemas/         # SQL migration & sample-env templates
│   │   ├── references/      # Static reference files
│   │   └── *.md.hbs         # AI tool context templates
│   └── utils/               # Cross-cutting utilities
├── dist/                    # Built JavaScript (generated by tsup, contains templates)
├── test/                    # Test files
├── .planning/               # GSD phase planning documents
├── tsconfig.json            # TypeScript configuration
├── tsup.config.ts           # Build configuration
├── package.json             # Dependencies
└── README.md                # User documentation
```

## Directory Purposes

**bin/:**
- Purpose: CLI entry point
- Contains: launchblocks.ts with commander program definition
- Key files: `bin/launchblocks.ts`

**src/commands/:**
- Purpose: Top-level command handlers
- Contains: init and add command implementations
- Key files:
  - `src/commands/init.ts` (276 lines) - handles `launchblocks init` with all flags
  - `src/commands/add.ts` (214 lines) - handles `launchblocks add role|provider`

**src/interview/:**
- Purpose: Interactive user input collection
- Contains: Question modules, runner, types
- Key files:
  - `src/interview/runner.ts` (129 lines) - orchestrates question sequence with step counting
  - `src/interview/types.ts` (108 lines) - InterviewAnswers, Permission enum, defaults
  - `src/interview/questions/roles.ts` (88 lines) - role selection logic
  - `src/interview/questions/permissions.ts` - permission assignment per role
  - `src/interview/questions/admin-access.ts` (61 lines) - admin role selection
  - `src/interview/questions/signup.ts` - signup approval requirement
  - `src/interview/questions/llm-access.ts` - which roles access LLM gateway
  - `src/interview/questions/providers.ts` - LLM provider selection
  - `src/interview/questions/app-info.ts` - app name and description
  - `src/interview/questions/ai-tool.ts` - which AI tool (Claude, Cursor, etc.)
  - `src/interview/questions/billing.ts` (55 lines) - billing feature inclusion

**src/generator/:**
- Purpose: Template-based file generation
- Contains: Config readers/writers, template utils, renderers for each artifact type
- Key files:
  - `src/generator/index.ts` (139 lines) - master orchestrator with 5-phase pipeline
  - `src/generator/config-writer.ts` (70 lines) - LaunchblocksConfig type and YAML writer
  - `src/generator/config-reader.ts` (191 lines) - YAML parser with validation
  - `src/generator/template-utils.ts` (141 lines) - Handlebars helpers and context builder
  - `src/generator/spec-renderer.ts` (45 lines) - renders 7-8 module spec markdown files
  - `src/generator/sql-renderer.ts` (61 lines) - renders 4-5 SQL migration files
  - `src/generator/context-renderer.ts` (92 lines) - renders master spec and tool context files

**src/setup/:**
- Purpose: AI tool integration setup
- Contains: MCP server detection and configuration guides
- Key files:
  - `src/setup/runner.ts` (57 lines) - orchestrates MCP setup flow
  - `src/setup/detect.ts` (52 lines) - scans for existing MCP configurations
  - `src/setup/guide.ts` (115 lines) - interactive setup prompts for Supabase/Vercel MCP
  - `src/setup/install.ts` (83 lines) - writes MCP config to ~/.claude.json, .cursor/mcp.json
  - `src/setup/types.ts` - McpServerStatus, SetupResult types

**src/templates/:**
- Purpose: Handlebars templates for generated output
- Contains: 22 template files
- Key files:
  - `src/templates/ai-context.md.hbs` - LaunchBlocks_implementation.md (master spec)
  - `src/templates/claude-md.md.hbs` - CLAUDE.md context for Claude Code
  - `src/templates/cursorrules.md.hbs` - .cursorrules context for Cursor
  - `src/templates/agents-md.md.hbs` - AGENTS.md context for Codex
  - `src/templates/gemini-md.md.hbs` - GEMINI.md context for Gemini
  - `src/templates/specs/*.hbs` - 8 module specifications (01-project-setup through 08-billing, billing conditional)
  - `src/templates/schemas/*.hbs` - 5 SQL migration templates (001-roles through 005-billing, billing conditional)
  - `src/templates/schemas/sample-env.md.hbs` - environment variable reference
  - `src/templates/references/*.md` - static reference files (3 files, not templated)

**src/utils/:**
- Purpose: Cross-cutting utilities
- Contains: Logging, validation, slug generation, shell execution
- Key files:
  - `src/utils/logger.ts` (304 lines) - colored output, file tree rendering, summary formatting
  - `src/utils/validation.ts` - role/app name validators, comma-separated parser
  - `src/utils/slug.ts` - kebab-case and title-case conversion
  - `src/utils/exec.ts` - subprocess execution wrapper
  - `src/utils/spinner.ts` - ora spinner helpers

**dist/:**
- Purpose: Compiled output (generated, not in git)
- Contains: Built JS files from tsup, templates copied by build script
- Note: `package.json` build script: `tsup && rm -rf dist/templates && cp -r src/templates dist/templates`

**test/:**
- Purpose: Test files
- Note: Test structure not analyzed in this focus (quality focus would cover this)

**.planning/codebase/:**
- Purpose: GSD phase planning documents
- Contains: ARCHITECTURE.md, STRUCTURE.md, and other analysis docs

## Key File Locations

**Entry Points:**
- `bin/launchblocks.ts` - CLI binary that registers all commands
- `src/commands/init.ts` - handles `launchblocks init`
- `src/commands/add.ts` - handles `launchblocks add`

**Configuration:**
- `src/interview/types.ts` - InterviewAnswers, Permission, AiTool types
- `src/generator/config-writer.ts` - LaunchblocksConfig type definition
- `tsconfig.json` - TypeScript compilation target ES2022, moduleResolution bundler
- `tsup.config.ts` - Build configuration (minimal)

**Core Logic:**
- `src/interview/runner.ts` - orchestrates 9-question interview with step counting
- `src/generator/index.ts` - 5-phase generation pipeline (config, context, specs, sql, references)
- `src/generator/template-utils.ts` - Handlebars context builder with all custom helpers
- `src/setup/runner.ts` - MCP server detection and setup orchestration

**Testing:**
- `test/` - test directory exists (content not analyzed)

## Naming Conventions

**Files:**
- Command modules: `src/commands/*.ts` (init.ts, add.ts)
- Question modules: `src/interview/questions/*.ts` kebab-case (app-info.ts, llm-access.ts, admin-access.ts)
- Renderers: `src/generator/*-renderer.ts` (spec-renderer, sql-renderer, context-renderer)
- Templates: `.hbs` extension (Handlebars), numbering for specs (01-project-setup.md.hbs)
- SQL migrations: `001_*.sql.hbs`, `002_*.sql.hbs` (numbered for ordering)

**Directories:**
- Feature areas: `src/interview/`, `src/generator/`, `src/setup/`
- Nested by type: `src/interview/questions/`, `src/templates/specs/`, `src/templates/schemas/`
- Output structure mirrors source: `launchblocks/specs/`, `launchblocks/schemas/migrations/`

**TypeScript Types:**
- Interfaces: PascalCase (InterviewAnswers, LaunchblocksConfig, RoleConfig)
- Enums/const arrays: UPPERCASE (ALL_PERMISSIONS, DEFAULT_ROLES)
- Functions: camelCase (runInterview, buildConfig, renderSpecs)

## Where to Add New Code

**New Question Module:**
- Implementation: `src/interview/questions/your-question.ts`
- Pattern: Export async function `ask*()` that returns Promise<T>
- Integration: Import in `src/interview/runner.ts`, add to question sequence, add step label
- Types: Extend `InterviewAnswers` in `src/interview/types.ts` with new field

**New Generator Phase:**
- Implementation: `src/generator/your-renderer.ts` with signature:
  ```typescript
  export async function renderYourPhase(
    outputDir: string,
    config: LaunchblocksConfig,
    context: Record<string, unknown>
  ): Promise<string[]>
  ```
- Templates: Create `.hbs` files in appropriate `src/templates/` subdirectory
- Integration: Import in `src/generator/index.ts`, add to generateProject phases (add to GenerateScope type)
- Scoping: If can be re-generated independently, add name to REGEN_SCOPE in `src/commands/add.ts`

**New CLI Command:**
- Implementation: `src/commands/your-command.ts` with handler function
- Integration: Import in `bin/launchblocks.ts`, register with `program.command()`
- Pattern: Follow init.ts or add.ts structure (options parsing, config reading/writing, generation, logging)

**New Utility:**
- Implementation: `src/utils/your-utility.ts`
- Export: Named exports for reusable functions
- Integration: Import where needed, no central registry

**New Template:**
- Location: `src/templates/` with appropriate subdirectory
- Format: Handlebars (.hbs) or static (.md for references)
- Conditional inclusion: Check `config.include_billing`, `config.ai_tool`, etc. in template
- Context available: All fields from `buildTemplateContext()` (roles, permissions, providers, flags, etc.)

**Testing New Features:**
- Test files co-located with source or in `test/` directory (pattern TBD from test focus)
- Use existing test configuration (pattern TBD)

## Special Directories

**src/templates/:**
- Purpose: Shipped with built code via `cp -r src/templates dist/templates` in build script
- Generated: No, authored by developers
- Committed: Yes, part of git repo
- Bundled: Yes, must be included in npm package (listed in `package.json` files array)

**dist/:**
- Purpose: Build output, compiled JS and templates
- Generated: Yes, by tsup and cp in build script
- Committed: No, in .gitignore
- Note: Contains both compiled TS and copied template files

**launchblocks/ (in generated projects):**
- Purpose: Output directory when user runs `launchblocks init`
- Generated: Yes, by generateProject()
- Committed: Optional (user decides)
- Contains: Config YAML, specs, SQL migrations, references, AI tool context files

**node_modules/:**
- Purpose: Dependencies
- Generated: Yes, by npm install
- Committed: No, in .gitignore

---

*Structure analysis: 2026-03-01*
